<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `PreparedQuery` struct in crate `ejdb`.">
    <meta name="keywords" content="rust, rustlang, rust-lang, PreparedQuery">

    <title>ejdb::PreparedQuery - Rust</title>

    <link rel="stylesheet" type="text/css" href="../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../main.css">
    

    
    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'><a href='index.html'>ejdb</a></p><script>window.sidebarCurrent = {name: 'PreparedQuery', ty: 'struct', relpath: ''};</script><script defer src="sidebar-items.js"></script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content struct">
<h1 class='fqn'><span class='in-band'>Struct <a href='index.html'>ejdb</a>::<wbr><a class='struct' href=''>PreparedQuery</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a id='src-1305' class='srclink' href='../src/ejdb/src/database/mod.rs.html#626-631' title='goto source code'>[src]</a></span></h1>
<pre class='rust struct'>pub struct PreparedQuery&lt;'coll,&nbsp;'db: 'coll,&nbsp;'out,&nbsp;Q,&nbsp;H&gt; {
    // some fields omitted
}</pre><div class='docblock'><p>Represents a query which is ready to be executed.</p>

<p>This structure is created out of <code>query::Query</code> object and provides methods to perform
queries in various ways. It is tied with a lifetime parameter to the collection this
query is executed on and therefore cannot outlive it.</p>

<p><code>PreparedQuery</code> is created using <code>Collection::query()</code> method.</p>
</div><h2 id='methods'>Methods</h2><h3 class='impl'><span class='in-band'><code>impl&lt;'coll,&nbsp;'db,&nbsp;'out,&nbsp;Q,&nbsp;H&gt; <a class='struct' href='../ejdb/struct.PreparedQuery.html' title='ejdb::PreparedQuery'>PreparedQuery</a>&lt;'coll,&nbsp;'db,&nbsp;'out,&nbsp;Q,&nbsp;H&gt; <span class='where'>where Q: <a class='trait' href='https://doc.rust-lang.org/nightly/core/borrow/trait.Borrow.html' title='core::borrow::Borrow'>Borrow</a>&lt;<a class='struct' href='../ejdb/query/struct.Query.html' title='ejdb::query::Query'>Query</a>&gt;, H: <a class='trait' href='https://doc.rust-lang.org/nightly/core/borrow/trait.Borrow.html' title='core::borrow::Borrow'>Borrow</a>&lt;<a class='struct' href='../ejdb/query/struct.QueryHints.html' title='ejdb::query::QueryHints'>QueryHints</a>&gt;</span></code></span><span class='out-of-band'><div class='ghost'></div><a id='src-1315' class='srclink' href='../src/ejdb/src/database/mod.rs.html#633-854' title='goto source code'>[src]</a></span></h3>
<div class='impl-items'><h4 id='method.log_output' class='method'><code>fn <a href='#method.log_output' class='fnname'>log_output</a>&lt;'o&gt;(self, target: &amp;'o mut <a class='trait' href='https://doc.rust-lang.org/nightly/std/io/trait.Write.html' title='std::io::Write'>Write</a> + 'o) -&gt; <a class='struct' href='../ejdb/struct.PreparedQuery.html' title='ejdb::PreparedQuery'>PreparedQuery</a>&lt;'coll,&nbsp;'db,&nbsp;'o,&nbsp;Q,&nbsp;H&gt;</code></h4>
<div class='docblock'><p>Sets the provided writer as a logging target for this query.</p>

<p>This method can be used to analyze how the query is executed. It is needed mostly for
debug purposes.</p>

<p>Unfortunately, due to EJDB API design, the data will be written to the provided target
only after the query is executed entirely (and <em>if</em> it is executed at all).</p>

<h1 id='example' class='section-header'><a href='#example'>Example</a></h1>
<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>ejdb</span>::<span class='ident'>query</span>::{<span class='ident'>Q</span>, <span class='ident'>QH</span>};
<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>io</span>::<span class='ident'>Write</span>;

<span class='kw'>let</span> <span class='ident'>db</span> <span class='op'>=</span> <span class='ident'>Database</span>::<span class='ident'>open</span>(<span class='string'>&quot;/path/to/db&quot;</span>).<span class='ident'>unwrap</span>();
<span class='kw'>let</span> <span class='ident'>coll</span> <span class='op'>=</span> <span class='ident'>db</span>.<span class='ident'>collection</span>(<span class='string'>&quot;some_collection&quot;</span>).<span class='ident'>unwrap</span>();

<span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>log_data</span> <span class='op'>=</span> <span class='ident'>Vec</span>::<span class='ident'>new</span>();
<span class='kw'>let</span> <span class='ident'>query</span> <span class='op'>=</span> <span class='ident'>coll</span>.<span class='ident'>query</span>(<span class='ident'>Q</span>.<span class='ident'>field</span>(<span class='string'>&quot;name&quot;</span>).<span class='ident'>eq</span>(<span class='string'>&quot;Foo&quot;</span>), <span class='ident'>QH</span>.<span class='ident'>empty</span>())
    .<span class='ident'>log_output</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>log_data</span>);
<span class='comment'>// the query now will log to `log_data` vector when executed</span></pre>
</div><h4 id='method.count' class='method'><code>fn <a href='#method.count' class='fnname'>count</a>(self) -&gt; <a class='type' href='../ejdb/types/type.Result.html' title='ejdb::types::Result'>Result</a>&lt;<a class='primitive' href='https://doc.rust-lang.org/nightly/std/primitive.u32.html'>u32</a>&gt;</code></h4>
<div class='docblock'><p>Executes the query, returning the affected number of records.</p>

<p>This method is equivalent to <code>find().map(|r| r.len())</code> but more efficient because
it does not load the actual data from the database.</p>

<p>Note that due to EJDB API structure this method is exactly equivalent to
<code>PreparedQuery::update()</code>, but it has its own name for semantic purposes.</p>

<h1 id='failures' class='section-header'><a href='#failures'>Failures</a></h1>
<p>Returns an error if the query document can&#39;t be serialized to EJDB representation,
if writing to the output log has failed or if any of the underlying EJDB operations
can&#39;t be completed successfully.</p>

<h1 id='example-1' class='section-header'><a href='#example-1'>Example</a></h1>
<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>ejdb</span>::<span class='ident'>query</span>::{<span class='ident'>Q</span>, <span class='ident'>QH</span>};

<span class='kw'>let</span> <span class='ident'>db</span> <span class='op'>=</span> <span class='ident'>Database</span>::<span class='ident'>open</span>(<span class='string'>&quot;/path/to/db&quot;</span>).<span class='ident'>unwrap</span>();
<span class='kw'>let</span> <span class='ident'>coll</span> <span class='op'>=</span> <span class='ident'>db</span>.<span class='ident'>collection</span>(<span class='string'>&quot;some_collection&quot;</span>).<span class='ident'>unwrap</span>();
<span class='kw'>let</span> <span class='ident'>query</span> <span class='op'>=</span> <span class='ident'>coll</span>.<span class='ident'>query</span>(<span class='ident'>Q</span>.<span class='ident'>field</span>(<span class='string'>&quot;name&quot;</span>).<span class='ident'>eq</span>(<span class='string'>&quot;Foo&quot;</span>), <span class='ident'>QH</span>.<span class='ident'>empty</span>());
<span class='kw'>let</span> <span class='ident'>n</span> <span class='op'>=</span> <span class='ident'>query</span>.<span class='ident'>count</span>().<span class='ident'>unwrap</span>();
<span class='comment'>// n is the number of records with &quot;name&quot; field equal to &quot;Foo&quot;</span></pre>
</div><h4 id='method.update' class='method'><code>fn <a href='#method.update' class='fnname'>update</a>(self) -&gt; <a class='type' href='../ejdb/types/type.Result.html' title='ejdb::types::Result'>Result</a>&lt;<a class='primitive' href='https://doc.rust-lang.org/nightly/std/primitive.u32.html'>u32</a>&gt;</code></h4>
<div class='docblock'><p>Executes the query which does not return results, returning the number of affected records.</p>

<p>No data is loaded from the database when this method is executed, so it is primarily
needed for updating queries.</p>

<p>Note that due to EJDB API structure this method is exactly equivalent to
<code>PreparedQuery::count()</code>, but it has its own name for semantic purposes.</p>

<h1 id='failures-1' class='section-header'><a href='#failures-1'>Failures</a></h1>
<p>Returns an error if the query document can&#39;t be serialized to EJDB representation,
if writing to the output log has failed or if any of the underlying EJDB operations
can&#39;t be completed successfully.</p>

<h1 id='example-2' class='section-header'><a href='#example-2'>Example</a></h1>
<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>ejdb</span>::<span class='ident'>query</span>::{<span class='ident'>Q</span>, <span class='ident'>QH</span>};

<span class='kw'>let</span> <span class='ident'>db</span> <span class='op'>=</span> <span class='ident'>Database</span>::<span class='ident'>open</span>(<span class='string'>&quot;/path/to/db&quot;</span>).<span class='ident'>unwrap</span>();
<span class='kw'>let</span> <span class='ident'>coll</span> <span class='op'>=</span> <span class='ident'>db</span>.<span class='ident'>collection</span>(<span class='string'>&quot;some_collection&quot;</span>).<span class='ident'>unwrap</span>();
<span class='kw'>let</span> <span class='ident'>n</span> <span class='op'>=</span> <span class='ident'>coll</span>.<span class='ident'>query</span>(<span class='ident'>Q</span>.<span class='ident'>field</span>(<span class='string'>&quot;name&quot;</span>).<span class='ident'>eq</span>(<span class='string'>&quot;Foo&quot;</span>).<span class='ident'>set</span>(<span class='string'>&quot;count&quot;</span>, <span class='number'>42</span>), <span class='ident'>QH</span>.<span class='ident'>empty</span>())
    .<span class='ident'>update</span>().<span class='ident'>unwrap</span>();
<span class='comment'>// n is the number of records affected by the update</span></pre>
</div><h4 id='method.find_one' class='method'><code>fn <a href='#method.find_one' class='fnname'>find_one</a>(self) -&gt; <a class='type' href='../ejdb/types/type.Result.html' title='ejdb::types::Result'>Result</a>&lt;<a class='enum' href='https://doc.rust-lang.org/nightly/core/option/enum.Option.html' title='core::option::Option'>Option</a>&lt;<a class='type' href='../ejdb/bson/type.Document.html' title='ejdb::bson::Document'>Document</a>&gt;&gt;</code></h4>
<div class='docblock'><p>Executes the query, returning the first matched element if it is available.</p>

<p>This method executes the prepared query, returning only one element matching the query.
This is more efficient than <code>PreparedQuery::find()</code> method because only one object
is actually loaded from the database.</p>

<h1 id='failures-2' class='section-header'><a href='#failures-2'>Failures</a></h1>
<p>Returns an error if the query document can&#39;t be serialized to EJDB representation,
if the returned document can&#39;t be deserialized from EJDB representation, if writing
to the output log has failed or if any of the underlying EJDB operations can&#39;t
be completed successfully.</p>

<h1 id='example-3' class='section-header'><a href='#example-3'>Example</a></h1>
<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>ejdb</span>::<span class='ident'>query</span>::{<span class='ident'>Q</span>, <span class='ident'>QH</span>};

<span class='kw'>let</span> <span class='ident'>db</span> <span class='op'>=</span> <span class='ident'>Database</span>::<span class='ident'>open</span>(<span class='string'>&quot;/path/to/db&quot;</span>).<span class='ident'>unwrap</span>();
<span class='kw'>let</span> <span class='ident'>coll</span> <span class='op'>=</span> <span class='ident'>db</span>.<span class='ident'>collection</span>(<span class='string'>&quot;some_collection&quot;</span>).<span class='ident'>unwrap</span>();
<span class='kw'>match</span> <span class='ident'>coll</span>.<span class='ident'>query</span>(<span class='ident'>Q</span>.<span class='ident'>field</span>(<span class='string'>&quot;name&quot;</span>).<span class='ident'>eq</span>(<span class='string'>&quot;Foo&quot;</span>), <span class='ident'>QH</span>.<span class='ident'>empty</span>()).<span class='ident'>find_one</span>().<span class='ident'>unwrap</span>() {
    <span class='prelude-val'>Some</span>(<span class='ident'>doc</span>) <span class='op'>=&gt;</span> { <span class='comment'>/* `doc` is the first record with &quot;name&quot; field equal to &quot;Foo&quot; */</span> }
    <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> { <span class='comment'>/* no document with &quot;name&quot; equal to &quot;Foo&quot; has been found */</span> }
}</pre>
</div><h4 id='method.find' class='method'><code>fn <a href='#method.find' class='fnname'>find</a>(self) -&gt; <a class='type' href='../ejdb/types/type.Result.html' title='ejdb::types::Result'>Result</a>&lt;<a class='struct' href='../ejdb/struct.QueryResult.html' title='ejdb::QueryResult'>QueryResult</a>&gt;</code></h4>
<div class='docblock'><p>Executes the query, returning an iterator of all documents matching the query.</p>

<p>This method executes the prepared query and returns an iterator of all records which match
it. This is the main method to use if you need to access multiple elements from the
database.</p>

<h1 id='failures-3' class='section-header'><a href='#failures-3'>Failures</a></h1>
<p>Returns an error if the query document can&#39;t be serialized to EJDB representation,
if writing to the output log has failed or if any of the underlying EJDB operations
can&#39;t be completed successfully. Each document from the query is deserialized from EJDB
representation separately when the iterator is traversed.</p>

<h1 id='example-4' class='section-header'><a href='#example-4'>Example</a></h1>
<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>ejdb</span>::<span class='ident'>query</span>::{<span class='ident'>Q</span>, <span class='ident'>QH</span>};

<span class='kw'>let</span> <span class='ident'>db</span> <span class='op'>=</span> <span class='ident'>Database</span>::<span class='ident'>open</span>(<span class='string'>&quot;/path/to/db&quot;</span>).<span class='ident'>unwrap</span>();
<span class='kw'>let</span> <span class='ident'>coll</span> <span class='op'>=</span> <span class='ident'>db</span>.<span class='ident'>collection</span>(<span class='string'>&quot;some_collection&quot;</span>).<span class='ident'>unwrap</span>();
<span class='kw'>let</span> <span class='ident'>result</span> <span class='op'>=</span> <span class='ident'>coll</span>.<span class='ident'>query</span>(<span class='ident'>Q</span>.<span class='ident'>field</span>(<span class='string'>&quot;name&quot;</span>).<span class='ident'>eq</span>(<span class='string'>&quot;Foo&quot;</span>), <span class='ident'>QH</span>.<span class='ident'>empty</span>()).<span class='ident'>find</span>().<span class='ident'>unwrap</span>();
<span class='kw'>let</span> <span class='ident'>items</span>: <span class='prelude-ty'>Result</span><span class='op'>&lt;</span><span class='ident'>Vec</span><span class='op'>&lt;</span>_<span class='op'>&gt;</span>, _<span class='op'>&gt;</span> <span class='op'>=</span> <span class='ident'>result</span>.<span class='ident'>collect</span>();  <span class='comment'>// collect all found records into a vector</span></pre>
</div></div></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../";
        window.currentCrate = "ejdb";
        window.playgroundUrl = "";
    </script>
    <script src="../jquery.js"></script>
    <script src="../main.js"></script>
    
    <script defer src="../search-index.js"></script>
</body>
</html>